<!doctype html>
<html lang="ko">
<head>
  <script src="./js/config.js"></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Log in</title>

  <!-- ✅ 단일 CSS -->
  <link rel="stylesheet" href="./css/login.css" />

</head>
<body>
  <header class="nav">
    <div class="nav-inner">
      <ul class="menu">
        <li><a href="./home.html">HOME</a></li>
        <li><a href="./collect.html">Collect</a></li>
        <li><a href="./gallery.html">Gallery</a></li>
        <li><a href="./custom.html">Custom</a></li>
      </ul>
      <div class="logo-cta">
        <a href="./mine.html">
          <img src="./asset/logo2.png" alt="logo" />
        </a>
      </div>
    </div>
  </header>

  <main id="main" class="auth-card" aria-labelledby="page-title">
    <h1 id="page-title" class="auth-title">Account</h1>

    <div class="auth-switch" role="tablist" aria-label="로그인/회원가입 전환">
      <button id="tab-login" class="auth-tab is-active" type="button"
              role="tab" aria-controls="login" aria-selected="true" tabindex="0">Sign in</button>
      <button id="tab-signup" class="auth-tab" type="button"
              role="tab" aria-controls="signup" aria-selected="false" tabindex="-1">Sign up</button>
    </div>

    <!-- 로그인 -->
    <form id="login" role="tabpanel" aria-labelledby="tab-login" novalidate>
      <label for="email">e-mail</label>
      <input id="email" type="email" name="email" required
             autocomplete="username email" inputmode="email"
             autocapitalize="off" spellcheck="false" class="input-lg"
             aria-invalid="false" aria-describedby="err-email"/>
      <p id="err-email" class="field-error" aria-live="polite"></p>

      <label for="pw">password</label>
      <div class="pw-field">
        <input id="pw" type="password" name="password" minlength="8" required
               autocomplete="current-password" enterkeyhint="go" class="input-lg"
               lang="en" inputmode="text" autocapitalize="none" spellcheck="false"
               pattern="[ -~]*"
               aria-invalid="false" aria-describedby="err-pw"/>
        <button type="button" class="pw-toggle" data-state="hidden" data-target="pw"
                aria-label="Show password" aria-pressed="false">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" class="icon-eye-open" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" class="icon-eye-closed" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" />
          </svg>
        </button>
      </div>
      <p id="err-pw" class="field-error" aria-live="polite"></p>

      <button class="btn-primary" type="submit">Sign in</button>
      <p id="login-error" class="form-error" aria-live="polite" aria-atomic="true"></p>

      <!-- 이메일/비밀번호 찾기 -->
      <div class="auth-switch recovery-switch" role="group" aria-label="Account recovery">
        <button id="find-email-btn" class="auth-tab" type="button">Find Email</button>
        <button id="find-password-btn" class="auth-tab" type="button">Reset Password</button>
      </div>
    </form>

    <!-- 회원가입 Step 1 -->
    <form id="signup" role="tabpanel" aria-labelledby="tab-signup" hidden novalidate>
      <div id="signup-step1">
        <label for="su-email">e-mail</label>
        <input id="su-email" type="email" name="email" required
              autocomplete="username email" inputmode="email"
              autocapitalize="off" spellcheck="false" class="input-lg"
              aria-invalid="false" aria-describedby="su-err-email"/>
        <p id="su-err-email" class="field-error" aria-live="polite"></p>

        <label for="su-pw">password</label>
        <div class="pw-field">
          <input id="su-pw" type="password" name="password" minlength="8" required
                autocomplete="new-password" enterkeyhint="go" class="input-lg"
                placeholder="8+ characters"
                lang="en" inputmode="text" autocapitalize="none" spellcheck="false"
                pattern="[ -~]*"
                aria-invalid="false" aria-describedby="su-err-pw"/>
          <button type="button" class="pw-toggle" data-state="hidden" data-target="su-pw"
                  aria-label="Show password" aria-pressed="false">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" class="icon-eye-open" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" class="icon-eye-closed" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" />
            </svg>
          </button>
        </div>
        <p id="su-err-pw" class="field-error" aria-live="polite"></p>

        <label for="su-pw2">verify password</label>
        <div class="pw-field">
          <input id="su-pw2" type="password" name="password2" minlength="8" required
                autocomplete="new-password" enterkeyhint="go" class="input-lg"
                lang="en" inputmode="text" autocapitalize="none" spellcheck="false"
                pattern="[ -~]*"
                aria-invalid="false" aria-describedby="su-err-pw2"/>
          <button type="button" class="pw-toggle" data-state="hidden" data-target="su-pw2"
                  aria-label="Show password" aria-pressed="false">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" class="icon-eye-open" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" class="icon-eye-closed" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" />
            </svg>
          </button>
        </div>
        <p id="su-err-pw2" class="field-error" aria-live="polite"></p>

        <button id="signup-next-btn" class="btn-primary" type="button">Next</button>
        <p id="signup-step1-error" class="form-error" aria-live="polite" aria-atomic="true"></p>
      </div>

      <!-- 회원가입 Step 2 -->
      <div id="signup-step2" hidden>
        <button type="button" id="signup-back-btn" class="back-btn" aria-label="Go back">
          Back
        </button>

        <label for="su-name">name</label>
        <input id="su-name" type="text" name="name" required
              autocomplete="name" class="input-lg"
              placeholder="This cannot be changed later"
              aria-invalid="false" aria-describedby="su-err-name"/>
        <p id="su-err-name" class="field-error" aria-live="polite"></p>

        <label for="su-birthdate">birthdate (MM/DD/YYYY)</label>
        <input id="su-birthdate" type="text" name="birthdate" required
              class="input-lg"
              placeholder="This cannot be changed later"
              aria-invalid="false" aria-describedby="su-err-birthdate"/>
        <p id="su-err-birthdate" class="field-error" aria-live="polite"></p>

        <button class="btn-primary" type="submit">Sign up</button>
        <p id="signup-error" class="form-error" aria-live="polite" aria-atomic="true"></p>
      </div>
    </form>

    <!-- Find Email Form -->
    <form id="find-email-form" hidden novalidate>
      <button type="button" id="find-email-back-btn" class="back-btn" aria-label="Go back">
        Back
      </button>

      <h2 class="auth-title">Find Email</h2>

      <label for="fe-name">name</label>
      <input id="fe-name" type="text" name="name" required
            autocomplete="name" class="input-lg"
            aria-invalid="false" aria-describedby="fe-err-name"/>
      <p id="fe-err-name" class="field-error" aria-live="polite"></p>

      <label for="fe-birthdate">birthdate (MM/DD/YYYY)</label>
      <input id="fe-birthdate" type="text" name="birthdate" required
            class="input-lg"
            placeholder="MM/DD/YYYY"
            aria-invalid="false" aria-describedby="fe-err-birthdate"/>
      <p id="fe-err-birthdate" class="field-error" aria-live="polite"></p>

      <button class="btn-primary" type="submit">Find Email</button>
      <p id="find-email-error" class="form-error" aria-live="polite" aria-atomic="true"></p>
      <p id="find-email-result" class="form-success" aria-live="polite" aria-atomic="true"></p>
    </form>

    <!-- Find Password Form -->
    <form id="find-password-form" hidden novalidate>
      <button type="button" id="find-password-back-btn" class="back-btn" aria-label="Go back">
        Back
      </button>

      <h2 class="auth-title">Reset Password</h2>

      <div id="reset-step1">
        <label for="fp-email">e-mail</label>
        <input id="fp-email" type="email" name="email" required
              autocomplete="username email" inputmode="email"
              autocapitalize="off" spellcheck="false" class="input-lg"
              aria-invalid="false" aria-describedby="fp-err-email"/>
        <p id="fp-err-email" class="field-error" aria-live="polite"></p>

        <button class="btn-primary" type="button" id="send-code-btn">Send Verification Code</button>
        <p id="reset-step1-error" class="form-error" aria-live="polite" aria-atomic="true"></p>
      </div>

      <div id="reset-step2" hidden>
        <label for="fp-code">verification code</label>
        <input id="fp-code" type="text" name="code" required
              maxlength="6" pattern="[0-9]{6}" inputmode="numeric"
              class="input-lg" placeholder="6-digit code"
              aria-invalid="false" aria-describedby="fp-err-code"/>
        <p id="fp-err-code" class="field-error" aria-live="polite"></p>

        <label for="fp-new-pw">new password</label>
        <div class="pw-field">
          <input id="fp-new-pw" type="password" name="newPassword" minlength="8" required
                autocomplete="new-password" class="input-lg"
                placeholder="8+ characters"
                lang="en" inputmode="text" autocapitalize="none" spellcheck="false"
                pattern="[ -~]*"
                aria-invalid="false" aria-describedby="fp-err-new-pw"/>
          <button type="button" class="pw-toggle" data-state="hidden" data-target="fp-new-pw"
                  aria-label="Show password" aria-pressed="false">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" class="icon-eye-open" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" class="icon-eye-closed" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" />
            </svg>
          </button>
        </div>
        <p id="fp-err-new-pw" class="field-error" aria-live="polite"></p>

        <button class="btn-primary" type="submit">Reset Password</button>
        <p id="reset-step2-error" class="form-error" aria-live="polite" aria-atomic="true"></p>
      </div>

      <!-- 전역 에러/성공 메시지 -->
      <p id="find-password-error" class="form-error" aria-live="polite" aria-atomic="true"></p>
    </form>

    <noscript>
      <p class="form-error">이 페이지는 자바스크립트가 필요합니다. 브라우저 설정에서 스크립트를 허용해 주세요.</p>
    </noscript>
  </main>

  <!-- 필요 시 소켓 -->
<script src="https://aud-api-cdvn.onrender.com/socket.io/socket.io.js"></script>

<script src="./js/socket-init.js"></script>

<!-- 1) 전역 인증 부팅 -->
<script src="./js/fetch-sanitizer.js"></script>

<script src="./js/auth-boot.js" defer></script>

<!-- 4) 세션 keepalive -->
<script src="./js/auth-keepalive.js" defer></script>

<!-- 2) Store (module) -->
<script type="module" src="./js/store.js"></script>

<!-- 3) UI 라우팅 가드/로고 -->
<script src="./js/logo-guard.js" defer></script>

<!-- (페이지별 앱 스크립트들) -->
<script type="module" src="./js/login.js"></script>

</body>
</html>
