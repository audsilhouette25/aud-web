<!-- FILE: public/me.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="./js/config.js"></script>
  <title>My Page</title>
  <!-- Inter Font (필수 가중치만 로드) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./css/me.css" />
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>

  <header class="nav" role="banner">
    <div class="nav-inner">
      <ul class="menu" role="navigation" aria-label="Main menu">
        <li><a href="./home.html">HOME</a></li>
        <li><a href="./collect.html">Collect</a></li>
        <li><a href="./gallery.html">Gallery</a></li>
        <li><a href="./custom.html">Custom</a></li>
        <li><a href="./game.html">Game</a></li>
      </ul>
      <div class="logo-cta">
        <a href="./me.html" aria-label="Go to My Page">
          <img src="./asset/logo2.png" alt="Go to My Page" />
        </a>
      </div>
    </div>
  </header>

  <main id="main" class="me" tabindex="-1">
    <!-- Profile Hero (unchanged) -->
    <section class="profile-hero" aria-label="프로필 요약">
      <div class="ph-left">
        <img id="me-avatar" class="avatar" src="" alt="프로필 이미지" width="88" height="88" />
        <div class="name-block">
          <h1 id="me-name" class="display-name">audor(e)</h1>
          <p id="me-email" class="email">—</p>
          <div class="badge-line">
            <span id="me-grade" class="grade-badge" hidden></span>
          </div>
        </div>
      </div>
      <div class="ph-right">
        <button id="btn-edit" class="btn ghost" type="button" aria-label="프로필 편집">Edit</button>
      </div>
    </section>

    <!-- Insights (unchanged) -->
    <section class="insights" aria-label="Vote insights">
      <article class="panel kpi-box">
        <div class="kpi-lg">
          <b id="m-posts">0</b>
          <span>My post</span>
        </div>
      </article>
      <article class="panel kpi-box">
        <div class="kpi-lg">
          <b id="m-participated">0</b>
          <span>Post participated in vote</span>
        </div>
      </article>
      <article class="panel rate-box">
        <h3>aud: match rate</h3>
        <div class="rate">
          <div class="bar" aria-hidden="true"><i id="m-rate-bar"></i></div>
          <div class="num"><b id="m-rate">0%</b><span id="m-rate-detail">(0 / 0)</span></div>
        </div>
      </article>
    </section>

    <!-- Quick + Laboratory (side-by-side on wide screen) -->
    <section class="quick lab-wrap" aria-label="Quick info and laboratory">
      <article class="panel">
        <h3>Collection</h3>
        <div class="grid-3">
          <div class="kpi"><b id="k-labels">0</b><span>aud:</span></div>
          <div class="kpi"><b id="k-jibs">0</b><span>Jibbitz</span></div>
          <div class="kpi"><b id="k-posts">0</b><span>Post</span></div>
        </div>
      </article>

      <!-- NEW: aud laboratory -->
      <article class="panel lab" aria-label="aud laboratory">
        <header class="lab-head">
          <h3>aud laboratory</h3>
          <div class="lab-stats" aria-live="polite">
            <span id="lab-strokes">0</span> strokes ·
            <span id="lab-points">0</span> points
          </div>
        </header>

        <div class="lab-canvas-wrap">
          <canvas id="aud-canvas" width="900" height="500" aria-label="소리 그리기 캔버스"></canvas>
        </div>

        <footer class="lab-controls">
          <button id="lab-play" class="btn primary" type="button" aria-pressed="false">Play</button>
          <div class="spacer"></div>
          <button id="lab-undo" class="btn ghost" type="button" disabled>Undo</button>
          <button id="lab-clear" class="btn ghost" type="button" disabled>Clear</button>
          <button id="lab-submit" class="btn" type="button" disabled>Submit</button>
        </footer>
      </article>
    </section>
    <!-- Admin · aud laboratory (popup modal) -->
    <div id="admin-lab" class="modal" aria-hidden="true" inert role="dialog" aria-modal="true" aria-labelledby="admin-lab-title">
      <button type="button" class="overlay" aria-label="Close"></button>
      <div class="sheet" role="document">
        <h2 id="admin-lab-title" class="title">aud laboratory — admin</h2>

        <div class="admin-toolbar">
          <div id="admin-lab-nsbar" class="nsbar" aria-label="Namespaces"></div>
          <div class="spacer"></div>
          <button id="admin-lab-refresh" class="btn" type="button">Refresh</button>
          <button id="admin-lab-close" class="btn" type="button">Close</button>
        </div>

        <div id="admin-lab-grid" class="admin-grid" aria-live="polite"></div>
        <p id="admin-lab-msg" class="hint" style="margin-top:8px;"></p>
      </div>
    </div>
  </main>

  <footer class="mine-footer">
    <div class="footer-inner">
      <button id="btn-logout" class="btn-logout" type="button">
        <span class="label">Log out</span>
      </button>
      <button id="btn-delete" class="btn btn-delete" aria-label="탈퇴"></button>
      <span class="sr-only">탈퇴</span>
    </div>
  </footer>

  <!-- 서버 상태 미리 fetch (렌더링 차단 없이 백그라운드에서) -->
  <script>
  (function(){
    var ns = (localStorage.getItem('auth:userns') || '').toLowerCase();
    if (!ns || ns.indexOf('@') < 0) return; // 이메일 NS만
    var api = (window.API_BASE || 'https://aud-api-cdvn.onrender.com') + '/api/state?ns=' + encodeURIComponent(ns);
    window.__prefetchState = fetch(api, { credentials: 'include', cache: 'no-store' })
      .then(function(r){ return r.ok ? r.json() : null; })
      .catch(function(){ return null; });
  })();
  </script>

  <!-- Scripts (defer로 비동기 로딩) -->
  <script src="./js/fetch-sanitizer.js" defer></script>
  <script src="./js/auth-boot.js" defer></script>
  <script src="./js/logo-guard.js" defer></script>
  <script type="module" src="./js/store.js"></script>
  <script>
    window.PROD_BACKEND = window.PROD_BACKEND || "https://aud-api-cdvn.onrender.com";
  </script>
  <script src="./js/me.js" type="module"></script>

  <!-- Tutorial system -->
  <script src="./js/tutorial.js" defer></script>

  <!-- Socket.io (non-critical, load last) -->
  <script src="https://aud-api-cdvn.onrender.com/socket.io/socket.io.js" defer></script>
  <script src="./js/socket-init.js" defer></script>

</body>
</html>
